{"version":3,"file":"maplibre-gl-indoorequal.umd.min.js","sources":["../node_modules/debounce/index.js","../node_modules/array-equal/index.js","../src/level_control.js","../src/layers.js","../src/image.js","../src/sprite.js","../src/index.js","../src/levels.js"],"sourcesContent":["function debounce(function_, wait = 100, options = {}) {\n\tif (typeof function_ !== 'function') {\n\t\tthrow new TypeError(`Expected the first parameter to be a function, got \\`${typeof function_}\\`.`);\n\t}\n\n\tif (wait < 0) {\n\t\tthrow new RangeError('`wait` must not be negative.');\n\t}\n\n\t// TODO: Deprecate the boolean parameter at some point.\n\tconst {immediate} = typeof options === 'boolean' ? {immediate: options} : options;\n\n\tlet storedContext;\n\tlet storedArguments;\n\tlet timeoutId;\n\tlet timestamp;\n\tlet result;\n\n\tfunction run() {\n\t\tconst callContext = storedContext;\n\t\tconst callArguments = storedArguments;\n\t\tstoredContext = undefined;\n\t\tstoredArguments = undefined;\n\t\tresult = function_.apply(callContext, callArguments);\n\t\treturn result;\n\t}\n\n\tfunction later() {\n\t\tconst last = Date.now() - timestamp;\n\n\t\tif (last < wait && last >= 0) {\n\t\t\ttimeoutId = setTimeout(later, wait - last);\n\t\t} else {\n\t\t\ttimeoutId = undefined;\n\n\t\t\tif (!immediate) {\n\t\t\t\tresult = run();\n\t\t\t}\n\t\t}\n\t}\n\n\tconst debounced = function (...arguments_) {\n\t\tif (\n\t\t\tstoredContext\n\t\t\t&& this !== storedContext\n\t\t\t&& Object.getPrototypeOf(this) === Object.getPrototypeOf(storedContext)\n\t\t) {\n\t\t\tthrow new Error('Debounced method called with different contexts of the same prototype.');\n\t\t}\n\n\t\tstoredContext = this; // eslint-disable-line unicorn/no-this-assignment\n\t\tstoredArguments = arguments_;\n\t\ttimestamp = Date.now();\n\n\t\tconst callNow = immediate && !timeoutId;\n\n\t\tif (!timeoutId) {\n\t\t\ttimeoutId = setTimeout(later, wait);\n\t\t}\n\n\t\tif (callNow) {\n\t\t\tresult = run();\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tObject.defineProperty(debounced, 'isPending', {\n\t\tget() {\n\t\t\treturn timeoutId !== undefined;\n\t\t},\n\t});\n\n\tdebounced.clear = () => {\n\t\tif (!timeoutId) {\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(timeoutId);\n\t\ttimeoutId = undefined;\n\t};\n\n\tdebounced.flush = () => {\n\t\tif (!timeoutId) {\n\t\t\treturn;\n\t\t}\n\n\t\tdebounced.trigger();\n\t};\n\n\tdebounced.trigger = () => {\n\t\tresult = run();\n\n\t\tdebounced.clear();\n\t};\n\n\treturn debounced;\n}\n\n// Adds compatibility for ES modules\nmodule.exports.debounce = debounce;\n\nmodule.exports = debounce;\n","/**\n * Compare arrays\n *\n * @param  {Array} arr1\n * @param  {Array} arr2\n * @return {Boolean} - Arrays are equals\n */\nmodule.exports = function equal(arr1, arr2) {\n  var length = arr1.length\n  if (arr1 === arr2) return true\n  if (length !== arr2.length) return false\n  for (var i = 0; i < length; i++)\n    if (arr1[i] !== arr2[i])\n      return false\n  return true\n}\n","export default class LevelControl {\n  constructor(indoorequal) {\n    this.indoorequal = indoorequal;\n    this._cbRefresh = () => this._refresh();\n    this.indoorequal.on('levelschange', this._cbRefresh);\n    this.indoorequal.on('levelchange', this._cbRefresh);\n\n    this.$el = document.createElement('div');\n    this.$el.classList.add('maplibregl-ctrl', 'maplibregl-ctrl-group', 'maplibregl-ctrl-indoorequal');\n    this._refresh();\n  }\n\n  destroy() {\n    this.$el.remove();\n    this.indoorequal.off('levelschange', this._cbRefresh);\n    this.indoorequal.off('levelchange', this._cbRefresh);\n  }\n\n  _refresh() {\n    this.$el.innerHTML = '';\n    this.indoorequal.levels.forEach((level) => {\n      const button = document.createElement('button');\n      const strong = document.createElement('strong');\n      strong.textContent = level;\n      button.appendChild(strong);\n      if (level == this.indoorequal.level) {\n        button.classList.add('maplibregl-ctrl-active');\n      }\n      button.addEventListener('click', () => {  this.indoorequal.setLevel(level); })\n      this.$el.appendChild(button);\n    });\n  }\n}\n","const commonPoi = {\n  \"type\": \"symbol\",\n  \"source-layer\": \"poi\",\n  \"layout\": {\n    \"icon-image\": [\n      \"coalesce\",\n      [\n        \"image\",\n        [\n          \"concat\",\n          [\n            \"literal\",\n            \"indoorequal-\"\n          ],\n          [\n            \"get\",\n            \"subclass\"\n          ]\n        ],\n      ],\n      [\n        \"image\",\n        [\n          \"concat\",\n          [\n            \"literal\",\n            \"indoorequal-\"\n          ],\n          [\n            \"get\",\n            \"class\"\n          ]\n        ]\n      ]\n    ],\n    \"text-anchor\": \"top\",\n    \"text-field\": [\n      \"case\",\n      // aeroway=gate\n      [\"==\", [\"get\", \"class\"], \"aeroway\"],\n      [\"get\", \"ref\"],\n      // default\n      [\"concat\",\n       [\"get\", \"name:latin\"],\n       \"\\n\",\n       [\"get\", \"name:nonlatin\"]\n      ],\n    ],\n    \"text-max-width\": 9,\n    \"text-offset\": [\n      0,\n      0.6\n    ],\n    \"text-padding\": 2,\n    \"text-size\": 12\n  },\n  \"paint\": {\n    \"text-color\": \"#666\",\n    \"text-halo-blur\": 0.5,\n    \"text-halo-color\": \"#ffffff\",\n    \"text-halo-width\": 1\n  }\n};\n\nconst rank2Class = [\"waste_basket\", \"information\", \"vending_machine\", \"bench\", \"photo_booth\", \"ticket_validator\"];\n\nexport const layers = [\n  {\n    id: \"indoor-polygon\",\n    type: \"fill\",\n    \"source-layer\": \"area\",\n    filter: [\n      \"all\",\n      [\n        \"==\",\n        \"$type\",\n        \"Polygon\"\n      ],\n      [\n        \"!=\",\n        \"class\",\n        \"level\"\n      ]\n    ],\n    paint: {\n      \"fill-color\": [\n        \"case\",\n        // if private\n        [\"all\", [\"has\", \"access\"], [\"in\", [\"get\", \"access\"], [\"literal\", [\"no\", \"private\"]]]],\n        \"#F2F1F0\",\n        // if POI\n        [\"any\",\n         [\"all\", [\"==\", [\"get\", \"is_poi\"], true], [\"!=\", [\"get\", \"class\"], \"corridor\"]],\n         [\n           \"in\",\n           [\"get\", \"subclass\"],\n           [\"literal\", [\"class\", \"laboratory\", \"office\", \"auditorium\", \"amphitheatre\", \"reception\"]]]\n        ],\n        \"#D4EDFF\",\n        // if is a room\n        [\"==\", [\"get\", \"class\"], \"room\"],\n        \"#fefee2\",\n        // default\n        \"#fdfcfa\"\n      ]\n    }\n  },\n  {\n    id: \"indoor-area\",\n    \"type\": \"line\",\n    \"source-layer\": \"area\",\n    \"filter\": [\n      \"all\",\n      [\n        \"in\",\n        \"class\",\n        \"area\",\n        \"corridor\",\n        \"platform\"\n      ]\n    ],\n    \"paint\": {\n      \"line-color\": \"#bfbfbf\",\n      \"line-width\": 1\n    }\n  },\n  {\n    id: \"indoor-column\",\n    \"type\": \"fill\",\n    \"source-layer\": \"area\",\n    \"filter\": [\n      \"all\",\n      [\n        \"==\",\n        \"class\",\n        \"column\"\n      ]\n    ],\n    \"paint\": {\n      \"fill-color\": \"#bfbfbf\"\n    }\n  },\n  {\n    id: \"indoor-lines\",\n    \"type\": \"line\",\n    \"source-layer\": \"area\",\n    \"filter\": [\n      \"all\",\n      [\n        \"in\",\n        \"class\",\n        \"room\",\n        \"wall\"\n      ]\n    ],\n    \"paint\": {\n      \"line-color\": \"gray\",\n      \"line-width\": 2\n    }\n  },\n  {\n    id: \"indoor-transportation\",\n    \"type\": \"line\",\n    \"source-layer\": \"transportation\",\n    \"filter\": [\n      \"all\"\n    ],\n    \"paint\": {\n      \"line-color\": \"gray\",\n      \"line-dasharray\": [\n        0.4,\n        0.75\n      ],\n      \"line-width\": {\n        \"base\": 1.4,\n        \"stops\": [\n          [\n            17,\n            2\n          ],\n          [\n            20,\n            10\n          ]\n        ]\n      }\n    }\n  },\n  {\n    id: \"indoor-transportation-poi\",\n    \"type\": \"symbol\",\n    \"source-layer\": \"transportation\",\n    \"filter\": [\n      \"all\",\n      [\n        \"in\",\n        \"$type\",\n        \"Point\",\n        \"LineString\"\n      ],\n      [\n        \"in\",\n        \"class\",\n        \"steps\",\n        \"elevator\",\n        \"escalator\"\n      ]\n    ],\n    \"layout\": {\n      \"icon-image\": [\n        \"case\",\n        [\n          \"has\",\n          \"conveying\"\n        ],\n        \"indoorequal-escalator\",\n        [\n          \"concat\",\n          [\n            \"literal\",\n            \"indoorequal-\"\n          ],\n          [\n            \"get\",\n            \"class\"\n          ]\n        ]\n      ],\n      \"symbol-placement\": \"line-center\",\n      \"icon-rotation-alignment\": \"viewport\"\n    }\n  },\n  {\n    id: \"indoor-poi-rank1\",\n    ...commonPoi,\n    \"filter\": [\n      \"all\",\n      [\n        \"==\",\n        \"$type\",\n        \"Point\"\n      ],\n      [\n        \"!in\",\n        \"class\",\n        ...rank2Class\n      ]\n    ]\n  },\n  {\n    id: \"indoor-poi-rank2\",\n    ...commonPoi,\n    minzoom: 19,\n    \"filter\": [\n      \"all\",\n      [\n        \"==\",\n        \"$type\",\n        \"Point\"\n      ],\n      [\n        \"in\",\n        \"class\",\n        ...rank2Class\n      ]\n    ]\n  },\n  {\n    id: \"indoor-heat\",\n    \"type\": \"heatmap\",\n    \"source-layer\": \"heat\",\n    \"filter\": [ \"all\" ],\n    \"paint\": {\n      \"heatmap-color\": [\"interpolate\", [\"linear\"], [\"heatmap-density\"],\n        0, \"rgba(102, 103, 173, 0)\",\n        0.1, \"rgba(102, 103, 173, 0.2)\",\n        1, \"rgba(102, 103, 173, 0.7)\"\n      ],\n      \"heatmap-radius\": [\n        \"interpolate\", [\"linear\"], [\"zoom\"],\n        0, 3,\n        13, 20,\n        17, 40\n      ],\n      \"heatmap-intensity\": 1,\n      \"heatmap-opacity\": [\n        \"interpolate\", [\"linear\"], [\"zoom\"],\n        16, 1,\n        17.1, 0\n      ]\n    }\n  },\n  {\n    id: \"indoor-name\",\n    \"type\": \"symbol\",\n    \"source-layer\": \"area_name\",\n    \"filter\": [\n      \"all\"\n    ],\n    \"layout\": {\n      \"text-field\": [\n        \"concat\",\n        [\"coalesce\",\n         [\"get\", \"name:latin\"],\n         [\"get\", \"ref\"],\n        ],\n        \"\\n\",\n        [\"get\", \"name:nonlatin\"],\n      ],\n      \"text-max-width\": 5,\n      \"text-size\": 14\n    },\n    \"paint\": {\n      \"text-color\": \"#666\",\n      \"text-halo-color\": \"#ffffff\",\n      \"text-halo-width\": 1\n    }\n  }\n];\n","function createImage(image, {width, height}, channels, data) {\n    if (!data) {\n        data = new Uint8Array(width * height * channels);\n    } else if (data instanceof Uint8ClampedArray) {\n        data = new Uint8Array(data.buffer);\n    } else if (data.length !== width * height * channels) {\n        throw new RangeError('mismatched image size');\n    }\n    image.width = width;\n    image.height = height;\n    image.data = data;\n    return image;\n}\n\nfunction resizeImage(image, {width, height}, channels) {\n    if (width === image.width && height === image.height) {\n        return;\n    }\n\n    const newImage = createImage({}, {width, height}, channels);\n\n    copyImage(image, newImage, {x: 0, y: 0}, {x: 0, y: 0}, {\n        width: Math.min(image.width, width),\n        height: Math.min(image.height, height)\n    }, channels);\n\n    image.width = width;\n    image.height = height;\n    image.data = newImage.data;\n}\n\nfunction copyImage(srcImg, dstImg, srcPt, dstPt, size, channels) {\n    if (size.width === 0 || size.height === 0) {\n        return dstImg;\n    }\n\n    if (size.width > srcImg.width ||\n        size.height > srcImg.height ||\n        srcPt.x > srcImg.width - size.width ||\n        srcPt.y > srcImg.height - size.height) {\n        throw new RangeError('out of range source coordinates for image copy');\n    }\n\n    if (size.width > dstImg.width ||\n        size.height > dstImg.height ||\n        dstPt.x > dstImg.width - size.width ||\n        dstPt.y > dstImg.height - size.height) {\n        throw new RangeError('out of range destination coordinates for image copy');\n    }\n\n    const srcData = srcImg.data;\n    const dstData = dstImg.data;\n\n    for (let y = 0; y < size.height; y++) {\n        const srcOffset = ((srcPt.y + y) * srcImg.width + srcPt.x) * channels;\n        const dstOffset = ((dstPt.y + y) * dstImg.width + dstPt.x) * channels;\n        for (let i = 0; i < size.width * channels; i++) {\n            dstData[dstOffset + i] = srcData[srcOffset + i];\n        }\n    }\n    return dstImg;\n}\n\n// Not premultiplied, because ImageData is not premultiplied.\n// UNPACK_PREMULTIPLY_ALPHA_WEBGL must be used when uploading to a texture.\nexport class RGBAImage {\n    constructor(size, data) {\n        createImage(this, size, 4, data);\n    }\n\n    resize(size) {\n        resizeImage(this, size, 4);\n    }\n\n    replace(data, copy) {\n        if (copy) {\n            this.data.set(data);\n        } else if (data instanceof Uint8ClampedArray) {\n            this.data = new Uint8Array(data.buffer);\n        } else {\n            this.data = data;\n        }\n    }\n\n    clone() {\n        return new RGBAImage({width: this.width, height: this.height}, new Uint8Array(this.data));\n    }\n\n    static copy(srcImg, dstImg, srcPt, dstPt, size) {\n        copyImage(srcImg, dstImg, srcPt, dstPt, size, 4);\n    }\n}\n","import {RGBAImage} from './image';\n\nfunction getImageData(img, padding) {\n  const canvas = window.document.createElement('canvas');\n  const context = canvas.getContext('2d');\n  if (!context) {\n    throw new Error('failed to create canvas 2d context');\n  }\n  canvas.width = img.width;\n  canvas.height = img.height;\n  context.drawImage(img, 0, 0, img.width, img.height);\n  return context.getImageData(0, 0, img.width, img.height);\n}\n\nexport default function(baseUrl) {\n  const format = window.devicePixelRatio > 1 ? '@2x' : '';\n  let json, image;\n\n  const jsonRequest = fetch(`${baseUrl}${format}.json`)\n        .then(r => r.json())\n        .then(r => json = r)\n\n  const imageRequest = fetch(`${baseUrl}${format}.png`)\n        .then(r => r.blob())\n        .then(r => {\n          image = new Image();\n          image.src = URL.createObjectURL(r);\n          return new Promise((resolve, reject) => {\n            image.onload = () => resolve();\n            image.onerror = () => reject();\n          });\n        });\n\n  return Promise.all([jsonRequest, imageRequest])\n    .then(() => {\n      const imageData = getImageData(image);\n      const result = {};\n\n      for (const id in json) {\n        const {width, height, x, y, sdf, pixelRatio, stretchX, stretchY, content} = json[id];\n        const data = new RGBAImage({width, height});\n        RGBAImage.copy(imageData, data, {x, y}, {x: 0, y: 0}, {width, height});\n        result[id] = {data, pixelRatio, sdf, stretchX, stretchY, content};\n      }\n      return result;\n    });\n}\n","import debounce from 'debounce';\nimport arrayEqual from 'array-equal';\nimport findAllLevels from './levels';\nimport LevelControl from './level_control';\nimport { layers } from './layers';\nimport loadSprite from './sprite';\n\nclass GeoJSONSource {\n  constructor(map, options = {}) {\n    const defaultOpts = { layers, geojson: {} };\n    const opts = { ...defaultOpts, ...options };\n    this.map = map;\n    this.geojson = opts.geojson;\n    this.layers = opts.layers;\n    this.baseSourceId = 'indoorequal';\n    this.sourceId = `${this.baseSourceId}_area`;\n  }\n\n  addSource() {\n    Object.keys(this.geojson).forEach((layerName) => {\n      this.map.addSource(`${this.baseSourceId}_${layerName}`, {\n        type: 'geojson',\n        data: this.geojson[layerName]\n      });\n    });\n  }\n\n  addLayers() {\n    const sourceLayers = Object.keys(this.geojson);\n    const layers = this.layers;\n    this.layers = layers.filter((layer) => {\n      return sourceLayers.includes(layer['source-layer']);\n    });\n    this.layers.forEach((layer) => {\n      this.map.addLayer({\n        source: `${this.baseSourceId}_${layer['source-layer']}`,\n        ...layer,\n        'source-layer': ''\n      });\n    });\n  }\n\n  remove() {\n    this.layers.forEach((layer) => {\n      this.map.removeLayer(layer.id);\n    });\n    Object.keys(this.geojson).forEach((layerName) => {\n      this.map.removeSource(`${this.baseSourceId}_${layerName}`);\n    });\n  }\n}\n\nclass VectorTileSource {\n  constructor(map, options = {}) {\n    const defaultOpts = { url: 'https://tiles.indoorequal.org/', layers };\n    const opts = { ...defaultOpts, ...options };\n    if (opts.url === defaultOpts.url && !opts.apiKey) {\n      throw 'You must register your apiKey at https://indoorequal.com before and set it as apiKey param.';\n    }\n    this.map = map;\n    this.url = opts.url;\n    this.apiKey = opts.apiKey;\n    this.layers = opts.layers;\n    this.sourceId = 'indoorequal';\n  }\n\n  addSource() {\n    const queryParams = this.apiKey ? `?key=${this.apiKey}` : '';\n    this.map.addSource(this.sourceId, {\n      type: 'vector',\n      url: `${this.url}${queryParams}`\n    });\n  }\n\n  addLayers() {\n    this.layers.forEach((layer) => {\n      this.map.addLayer({\n        source: this.sourceId,\n        ...layer\n      });\n    });\n  }\n\n  remove() {\n    this.layers.forEach((layer) => {\n      this.map.removeLayer(layer.id);\n    });\n    this.map.removeSource(this.sourceId);\n  }\n}\n\n/**\n * Load the indoor= source and layers in your map.\n * @param {object} map the maplibre-gl instance of the map\n * @param {object} options\n * @param {string} [options.url] Override the default tiles URL (https://tiles.indoorequal.org/).\n * @param {object} [options.geojson] GeoJSON data with with key as layer name and value with geojson features\n * @param {string} [options.apiKey] The API key if you use the default tile URL (get your free key at [indoorequal.com](https://indoorequal.com)).\n * @param {array} [options.layers] The layers to be used to style indoor= tiles. Take a look a the [layers.js file](https://github.com/indoorequal/maplibre-gl-indoorequal/blob/master/src/layers.js) file and the [vector schema](https://indoorequal.com/schema)\n * @param {boolean} [options.heatmap] Should the heatmap layer be visible at start (true : visible, false : hidden). Defaults to true/visible.\n * @property {string} level The current level displayed\n * @property {array} levels  The levels that can be displayed in the current view\n * @fires IndoorEqual#levelschange\n * @fires IndoorEqual#levelchange\n * @return {IndoorEqual} `this`\n */\nexport default class IndoorEqual {\n  constructor(map, options = {}) {\n    const SourceKlass = options.geojson ? GeoJSONSource : VectorTileSource;\n    const defaultOpts = { heatmap: true };\n    const opts = { ...defaultOpts, ...options };\n    this.source = new SourceKlass(map, options);\n    this.map = map;\n    this.levels = [];\n    this.level = '0';\n    this.events = {};\n\n    if (this.map.isStyleLoaded()) {\n      this._init();\n      this.setHeatmapVisible(opts.heatmap);\n    } else {\n      this.map.once('load', () => {\n        this._init();\n        this.setHeatmapVisible(opts.heatmap);\n      });\n    }\n  }\n\n  /**\n   * Remove any layers, source and listeners and controls\n   */\n  remove(fromRemoveEvent) {\n    if (!fromRemoveEvent) {\n      this.source.remove();\n    }\n    this._updateLevelsDebounce.clear();\n    this.map.off('load', this._updateLevelsDebounce);\n    this.map.off('data', this._updateLevelsDebounce);\n    this.map.off('move', this._updateLevelsDebounce);\n    if (this._control) {\n      this.onRemove();\n    }\n  }\n\n  /**\n   * Add an event listener\n   * @param {string} name the name of the event\n   * @param {function} fn the function to be called when the event is emitted\n   */\n  on(name, fn) {\n    if (!this.events[name]) {\n      this.events[name] = [];\n    }\n    this.events[name].push(fn);\n  }\n\n  /**\n   * Remove an event listener.\n   * @param {string} name the name of the event\n   * @param {function} fn the same function when on() was called\n   */\n  off(name, fn) {\n    if (!this.events[name]) {\n      this.events[name] = [];\n    }\n    this.events[name] = this.events[name].filter(cb => cb !== fn);\n  }\n\n  /**\n   * Add the level control to the map\n   * Used when adding the control via the map instance: map.addControl(indoorEqual)\n   */\n  onAdd() {\n    this._control = new LevelControl(this);\n    return this._control.$el;\n  }\n\n  /**\n   * Remove the level control\n   * Used when removing the control via the map instance: map.removeControl(indoorEqual)\n   */\n  onRemove() {\n    this._control.destroy();\n    this._control = null;\n  }\n\n  /**\n   * Set the displayed level.\n   * @param {string} level the level to be displayed\n   * @fires IndoorEqual#levelchange\n   */\n  setLevel(level) {\n    this.level = level;\n    this._updateFilters();\n    this._emitLevelChange();\n  }\n\n  /**\n   * Set the displayed level.\n   * @deprecated Use setLevel instead\n   * @param {string} level the level to be displayed\n   * @fires IndoorEqual#levelchange\n   */\n  updateLevel(level) {\n    console.log('The updateLevel method is deprecated. Please use setLevel instead.');\n    this.setLevel(level);\n  }\n\n  /**\n   * Load a sprite and add all images to the map\n   * @param {string} baseUrl the baseUrl where to load the sprite\n   * @param {object} options\n   * @param {boolean} [options.update] Update existing image (default false)\n   * @return {Promise} It resolves an hash of images.\n   */\n  loadSprite(baseUrl, options = {}) {\n    const opts = { update: false, ...options };\n    return loadSprite(baseUrl)\n      .then((sprite) => {\n        for (const id in sprite) {\n          const { data, ...options } = sprite[id];\n          if (!this.map.hasImage(id)) {\n            this.map.addImage(id, data, options);\n          } else if (opts.update) {\n            this.map.updateImage(id, data);\n          }\n        }\n        return sprite;\n      });\n  }\n\n  /**\n   * Change the heatmap layer visibility\n   * @param {boolean} visible True to make it visible, false to hide it\n   */\n  setHeatmapVisible(visible) {\n    if (this.map.getLayer('indoor-heat')) {\n      this.map.setLayoutProperty('indoor-heat', 'visibility', visible ? 'visible' : 'none');\n    }\n  }\n\n  _init() {\n    this.source.addSource();\n    this.source.addLayers();\n    this._updateFilters();\n    this._updateLevelsDebounce = debounce(this._updateLevels.bind(this), 1000);\n\n    this.map.on('load', this._updateLevelsDebounce);\n    this.map.on('data', this._updateLevelsDebounce);\n    this.map.on('move', this._updateLevelsDebounce);\n    this.map.on('remove', () => {\n      this.remove(true);\n    });\n  }\n\n  _updateFilters() {\n    this.source.layers\n    .filter(layer => layer.type !== 'heatmap')\n    .forEach((layer) => {\n      this.map.setFilter(layer.id, [ ...layer.filter || ['all'], ['==', 'level', this.level]]);\n    });\n  }\n\n  _refreshAfterLevelsUpdate() {\n    if (!this.levels.includes(this.level)) {\n      this.setLevel('0');\n    }\n  }\n\n  _updateLevels() {\n    if (this.map.isSourceLoaded(this.source.sourceId)) {\n      const features = this.map.querySourceFeatures(this.source.sourceId, { sourceLayer: 'area' });\n      const levels = findAllLevels(features);\n      if (!arrayEqual(levels, this.levels)) {\n        this.levels = levels;\n        this._emitLevelsChange();\n        this._refreshAfterLevelsUpdate();\n      }\n    }\n  }\n\n  _emitLevelsChange() {\n    this._emitEvent('levelschange', this.levels);\n  }\n\n  _emitLevelChange() {\n    this._emitEvent('levelchange', this.level);\n  }\n\n  _emitEvent(eventName, ...args) {\n    (this.events[eventName] || []).forEach(fn => fn(...args));\n  }\n}\n\n/**\n * Emitted when the list of available levels has been updated\n *\n * @event IndoorEqual#levelschange\n * @type {array}\n */\n\n/**\n * Emitted when the current level has been updated\n *\n * @event IndoorEqual#levelchange\n * @type {string} always emitted when the level displayed has changed\n */\n","export default function findAllLevels(features) {\n  const levels = [];\n  for (let i = 0; i < features.length; i++) {\n    const feature = features[i];\n    if (feature.properties.class === 'level') {\n      continue;\n    }\n    const level = feature.properties.level;\n    if (!levels.includes(level)) {\n      levels.push(level);\n    }\n  }\n  return levels.sort((a, b) => a - b).reverse();\n}\n"],"names":["debounce","function_","wait","options","TypeError","RangeError","immediate","storedContext","storedArguments","timeoutId","timestamp","result","run","callContext","callArguments","undefined","apply","later","last","Date","now","setTimeout","debounced","arguments_","this","Object","getPrototypeOf","Error","callNow","defineProperty","get","clear","clearTimeout","flush","trigger","debounceModule","exports","arrayEqual","arr1","arr2","length","i","LevelControl","_createClass","indoorequal","_this","_classCallCheck","_cbRefresh","_refresh","on","$el","document","createElement","classList","add","key","value","remove","off","_this2","innerHTML","levels","forEach","level","button","strong","textContent","appendChild","addEventListener","setLevel","commonPoi","type","layout","paint","rank2Class","layers","id","filter","base","stops","_objectSpread","concat","minzoom","createImage","image","_ref","channels","data","width","height","Uint8ClampedArray","Uint8Array","buffer","copyImage","srcImg","dstImg","srcPt","dstPt","size","x","y","srcData","dstData","srcOffset","dstOffset","RGBAImage","_ref2","newImage","Math","min","resizeImage","copy","set","_loadSprite","baseUrl","json","format","window","devicePixelRatio","jsonRequest","fetch","then","r","imageRequest","blob","Image","src","URL","createObjectURL","Promise","resolve","reject","onload","onerror","all","imageData","img","canvas","context","getContext","drawImage","getImageData","_json$id","sdf","pixelRatio","stretchX","stretchY","content","GeoJSONSource","map","arguments","opts","defaultOpts","geojson","baseSourceId","sourceId","keys","layerName","addSource","sourceLayers","layer","includes","addLayer","source","_this3","removeLayer","removeSource","VectorTileSource","url","apiKey","queryParams","_this4","_this5","IndoorEqual","_this6","SourceKlass","heatmap","events","isStyleLoaded","_init","setHeatmapVisible","once","fromRemoveEvent","_updateLevelsDebounce","_control","onRemove","name","fn","push","cb","destroy","_updateFilters","_emitLevelChange","console","log","_this7","update","loadSprite","sprite","_sprite$id","_objectWithoutProperties","_excluded","hasImage","updateImage","addImage","visible","getLayer","setLayoutProperty","_this8","addLayers","_updateLevels","bind","_this9","setFilter","_toConsumableArray","isSourceLoaded","features","feature","properties","sort","a","b","reverse","findAllLevels","querySourceFeatures","sourceLayer","_emitLevelsChange","_refreshAfterLevelsUpdate","_emitEvent","eventName","_len","args","Array","_key"],"mappings":"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","x_google_ignoreList":[0,1]}